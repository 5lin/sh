(common_core) {
    tls internal
    encode zstd gzip
    
    # ç»Ÿä¸€å®‰å…¨å¤´
    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        -Server
    }
}

(proxy_headers) {
    # å¼ºåˆ¶å°† CF ä¼ é€’è¿‡æ¥çš„ IP è®¾ä¸ºçœŸå® IP
    header_up X-Real-IP {header.CF-Connecting-IP}
    header_up X-Forwarded-For {header.CF-Connecting-IP}
    # é€ä¼  Hostï¼Œé˜²æ­¢åç«¯åº”ç”¨(å¦‚OA)å› ä¸º Host ä¸å¯¹è€ŒæŠ¥é”™
    header_up Host {host}
}

# =================================================
# 2. ç«™ç‚¹é…ç½® (å·²ä¿®æ­£)
# =================================================

# ğŸ¢ OA ç³»ç»Ÿ
# ------------------------------
oa.example.com {
    import common_core

    reverse_proxy 127.0.0.1:18111 {
        import proxy_headers
    }
}

# ğŸ“§ Webmail é‚®ç®±
# ------------------------------
webmail.example.com {
    import common_core

    reverse_proxy 127.0.0.1:8808 {
        import proxy_headers
    }
}

# ğŸ’¬ è¯„è®ºç³»ç»Ÿ
# ------------------------------
comments.example.com {
    import common_core

    reverse_proxy 127.0.0.1:8080 {
        import proxy_headers
    }
}